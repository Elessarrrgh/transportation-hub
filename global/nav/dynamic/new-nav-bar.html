<!-- Removes header and pagination from gallery content (hotel) pages -->
<style>
  .header, #footer-sections { 
    display:none !important;
  }
  .item-pagination {
    display:none !important;
  }
</style>

<!-- ========= HOTEL HEADER + NAV (drop-in) ========= -->
<header id="hotel-header" role="banner" aria-label="Hotel navigation header">
  <div class="hotel-toolbar">
    <button class="back-btn" type="button" aria-label="Go back">
      <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
        <path d="M15.5 19.5L8 12l7.5-7.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="back-label">Back</span>
    </button>
    <div class="hotel-title" aria-live="polite" aria-atomic="true"></div>
    <div class="toolbar-spacer" aria-hidden="true"></div>
  </div>

  <nav id="hotel-nav" aria-label="Section navigation">
    <ul><!-- items are injected by script --></ul>
  </nav>
</header>

<style>
/* ===== Tokens (tweak per show or move to sitewide CSS later) ===== */
:root{
  --toolbar-h:44px;            /* mini toolbar height */
  --nav-h:60px;                /* scroller nav height */
  --header-shadow:0 1px 0 rgba(0,0,0,.06),0 4px 12px rgba(0,0,0,.04);
  --border:#e6e6e6;
  --bg:#fff;
  --text:#222;
  --muted:#666;
  --brand:#0077cc;
  --brand-contrast:#fff;
}

/* Smooth anchors; JS will keep scroll-padding in sync with header height */
html{ scroll-behavior:smooth; scroll-padding-top:calc(var(--toolbar-h)+var(--nav-h)+8px); }

/* Body padding is set precisely by JS after header renders */
body{
  padding-top: 0;
}

/* ===== Fixed header ===== */
#hotel-header{
  position:fixed; top:0; left:0; right:0;
  background:var(--bg);
  z-index:9999;
  box-shadow:var(--header-shadow);
  font-family:inherit;
}

/* Toolbar row */
#hotel-header .hotel-toolbar{
  display:grid; grid-template-columns:auto 1fr auto;
  align-items:center;
  height:var(--toolbar-h);
  padding:0 8px;
  border-bottom:1px solid var(--border);
}
#hotel-header .back-btn{
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 8px; background:transparent; border:0;
  color:var(--text); cursor:pointer; border-radius:8px;
}
#hotel-header .back-btn:hover{ background:rgba(0,0,0,.04); }
#hotel-header .back-btn:focus-visible{ outline:2px solid var(--brand); outline-offset:2px; }
#hotel-header .back-label{ font-size:13px; color:var(--muted); }
#hotel-header .hotel-title{
  text-align:center; font-weight:600; font-size:15px; color:var(--text);
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding:0 6px;
}
#hotel-header .toolbar-spacer{ width:56px; }

/* Nav row */
#hotel-nav{ height:var(--nav-h); background:var(--bg); }
#hotel-nav ul{
  display:flex; align-items:center; gap:8px;
  justify-content:center;             /* center when items fit */
  overflow-x:auto; margin:0; padding:6px 8px; list-style:none;
  scrollbar-width:none; -webkit-overflow-scrolling:touch;
  scroll-snap-type:x proximity;       /* optional: nice feel */
}
#hotel-nav ul::-webkit-scrollbar{ display:none; }
#hotel-nav li{ flex:0 0 auto; scroll-snap-align:center; }
#hotel-nav a{
  display:inline-flex; flex-direction:column; align-items:center; gap:4px;
  text-decoration:none; color:var(--text); font-weight:500; font-size:12px;
  padding:6px 10px; border-radius:10px;
}
#hotel-nav a:focus-visible{ outline:2px solid var(--brand); outline-offset:2px; }
#hotel-nav a.active{ background:var(--brand); color:var(--brand-contrast); }
#hotel-nav .nav-icon{ width:18px; height:18px; display:block; }

/* Anchor targets stop below header (JS also adjusts at runtime) */
section[id]{ scroll-margin-top:calc(var(--toolbar-h)+var(--nav-h)+8px); }

/* Accessibility: honor reduced motion */
@media (prefers-reduced-motion:reduce){
  html{ scroll-behavior:auto; }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  /* ===== Variant config =====
     Set icon to a URL if you want images; if null, no <img> is inserted. */
  const NAV_VARIANTS = {
    shuttle: [
      { id:"#shuttle",  label:"Shuttle Info", icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/bbff25a9-f8f6-48fd-9971-82c83a84fa63/bus-icon.png?content-type=image%2Fpng" },
      { id:"#stop",     label:"Stop Info",    icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/4851a3bd-f70a-4025-8b61-1abf053be1dc/shuttle-stop-bus-icon.png?content-type=image%2Fpng" },
      { id:"#schedule", label:"Schedule",     icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/0a8ab806-7ef5-4f6f-a844-50dd9d6513e2/schedule-icon.png?content-type=image%2Fpng" },
      { id:"#hotel",    label:"Hotel Info",   icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/48812ef1-55ab-47ab-8810-278cdb3a7b56/hotel-icon.png?content-type=image%2Fpng" },
      { id:"#support",  label:"Support",      icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/8cb25285-b9e4-4ba3-9c3e-c6fc5bac327b/help-icon.png?content-type=image%2Fpng" },
    ],
    walking: [
      { id:"#walking",  label:"Directions",   icon:null },
      { id:"#hotel",    label:"Hotel Info",   icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/48812ef1-55ab-47ab-8810-278cdb3a7b56/hotel-icon.png?content-type=image%2Fpng" },
      { id:"#support",  label:"Support",      icon:"https://images.squarespace-cdn.com/content/602b1e3b9f10401f2e609ddb/8cb25285-b9e4-4ba3-9c3e-c6fc5bac327b/help-icon.png?content-type=image%2Fpng" },
    ],
  };

  /* ===== URL-driven detection: /.../hotels/<route>/<stop>/... ===== */
  const detectVariant = () => {
    const parts = location.pathname.toLowerCase().split('/').filter(Boolean);
    const idx = parts.indexOf('hotels');
    let routeSeg = null, stopSeg = null;

    if (idx >= 0) {
      routeSeg = parts[idx + 1] || null;  // "w" or a number string
      stopSeg  = parts[idx + 2] || null;
    }
    if (routeSeg) document.body.classList.add(`route-${routeSeg}`);
    if (stopSeg)  document.body.classList.add(`stop-${stopSeg}`);

    const qs = new URLSearchParams(location.search);
    const override = qs.get('variant');
    if (override === 'walking' || override === 'shuttle') return override;

    return routeSeg === 'w' ? 'walking' : 'shuttle';
  };

  /* ===== Build navbar items for chosen variant ===== */
  const buildNavbar = (variantKey) => {
    document.body.classList.remove("variant-shuttle","variant-walking");
    document.body.classList.add(`variant-${variantKey}`);

    const def = NAV_VARIANTS[variantKey] || [];
    const ul = document.querySelector("#hotel-nav ul");
    if (!ul) return [];

    ul.innerHTML = "";
    const used = [];
    for (const item of def) {
      const target = document.querySelector(item.id);
      if (!target) continue; // skip items whose sections are absent

      const li = document.createElement("li");
      const a  = document.createElement("a");
      a.href   = item.id;

      if (item.icon) {
        const img = document.createElement("img");
        img.className = "nav-icon"; img.alt = ""; img.setAttribute("aria-hidden","true");
        img.src = item.icon; a.appendChild(img);
      }
      const span = document.createElement("span");
      span.textContent = item.label; a.appendChild(span);

      li.appendChild(a); ul.appendChild(li);
      used.push({ id: item.id, el: target, link: a });
    }
    return used;
  };

  /* ===== Back button ===== */
  const backBtn = document.querySelector(".back-btn");
  const fallbackURL = "/transportation"; // change to your shuttle search
  if (backBtn) {
    backBtn.addEventListener("click", () => {
      if (window.history.length > 1) history.back();
      else window.location.href = fallbackURL;
    });
  }

  /* ===== Title auto-detect (Squarespace-friendly) ===== */
  const titleEl = document.querySelector(".hotel-title");
  if (titleEl) {
    const candidates = [
      '[data-content-field="title"]',
      '.BlogItem-title',
      '.Entry-title',
      'h1[itemprop="headline"]',
      'h1[data-collection-title]',
      'h1'
    ];
    let titleText = "";
    for (const sel of candidates) {
      const n = document.querySelector(sel);
      if (n && n.textContent.trim()) { titleText = n.textContent.trim(); break; }
    }
    if (!titleText) {
      const parts = (document.title || "").split(/\s[—–|•]\s/);
      titleText = (parts[0] || "Hotel").trim();
    }
    titleEl.textContent = titleText;
  }

  /* ===== Render navbar for this page ===== */
  const variant = detectVariant();
  let sections = buildNavbar(variant);          // [{id, el, link}, ...]
  const navLinks = sections.map(s => s.link);
  if (!navLinks.length) return;

  /* ===== Header offset + padding ===== */
  const getHeaderOffset = () => {
    const cs = getComputedStyle(document.documentElement);
    const toolbarH = parseFloat(cs.getPropertyValue('--toolbar-h')) || 44;
    const navH     = parseFloat(cs.getPropertyValue('--nav-h')) || 44;
    return Math.round(toolbarH + navH);
  };

  const setBodyPadding = () => {
    const header = document.getElementById("hotel-header");
    if (!header) return;
    const h = header.getBoundingClientRect().height;
    document.body.style.paddingTop = `${Math.ceil(h)}px`;
    document.documentElement.style.scrollPaddingTop = `${Math.ceil(h) + 8}px`;
    document.querySelectorAll("section[id]").forEach(sec => {
      sec.style.scrollMarginTop = `${Math.ceil(h) + 8}px`;
    });
  };
  setBodyPadding();
  window.addEventListener("resize", setBodyPadding);

  /* ===== Scroll-spy (midpoint range) + anti-flicker pin ===== */
  let ids = [], tops = [], mids = [];

  const measure = () => {
    const headerOffset = getHeaderOffset();
    const data = sections.map(({ id, el }) => ({
      id, top: Math.floor(el.getBoundingClientRect().top + window.pageYOffset - headerOffset)
    })).sort((a,b) => a.top - b.top);

    ids  = data.map(d => d.id);
    tops = data.map(d => d.top);

    mids = [];
    for (let i = 0; i < tops.length - 1; i++) {
      mids.push((tops[i] + tops[i+1]) / 2);
    }
  };

  const setActive = (id) => {
    navLinks.forEach(a => a.classList.toggle("active", a.getAttribute("href") === id));
  };

  // Pinning to prevent flicker during smooth scroll
  let pinId = null, pinTargetTop = null, pinUntil = 0;
  const near = (a, b, eps = 6) => Math.abs(a - b) <= eps;
  const now  = () => performance.now();
  const pinActive = (id, targetTop, ms = 1200) => { pinId = id; pinTargetTop = targetTop; pinUntil = now() + ms; setActive(id); };
  const unpinActive = () => { pinId = pinTargetTop = null; pinUntil = 0; };
  ['wheel','touchstart','keydown','mousedown'].forEach(evt => window.addEventListener(evt, unpinActive, { passive:true }));
  if ('onscrollend' in window) window.addEventListener('scrollend', unpinActive);

  let ticking = false;
  const onScroll = () => {
    if (ticking) return;
    ticking = true;
    requestAnimationFrame(() => {
      if (pinId) {
        const y = window.pageYOffset;
        if ((pinTargetTop != null && near(y, pinTargetTop)) || now() > pinUntil) {
          unpinActive();
        } else {
          setActive(pinId);
          ticking = false; return;
        }
      }
      if (!ids.length) { ticking = false; return; }

      const y = window.pageYOffset;
      let idx = 0;
      while (idx < mids.length && y >= mids[idx]) idx++;
      setActive(ids[idx]);
      ticking = false;
    });
  };

  // Intercept clicks: smooth scroll + pin
  navLinks.forEach(a => {
    a.addEventListener("click", (e) => {
      const id = a.getAttribute("href");
      const target = document.querySelector(id);
      if (!target) return;
      e.preventDefault();

      const headerOffset = getHeaderOffset();
      const targetTop = Math.floor(target.getBoundingClientRect().top + window.pageYOffset - headerOffset);

      pinActive(id, targetTop);
      window.scrollTo({ top: targetTop, behavior:'smooth' });
    });
  });

  // Initial measure + listeners
  measure(); onScroll();
  window.addEventListener("scroll", onScroll, { passive:true });
  window.addEventListener("resize", () => { measure(); onScroll(); });
  window.addEventListener("load",  () => { setBodyPadding(); measure(); onScroll(); });

  // Hook for dynamic content changes (e.g., accordions opening)
  window.remeasureNavSpy = () => { setBodyPadding(); measure(); onScroll(); };

  // If your loader swaps content after render, you can rebuild the nav:
  document.addEventListener("th:content-ready", () => {
    sections = buildNavbar(detectVariant());
    const newLinks = Array.from(document.querySelectorAll("#hotel-nav a[href^='#']"));
    newLinks.forEach(a => {
      a.addEventListener("click", (e) => {
        const id = a.getAttribute("href");
        const target = document.querySelector(id);
        if (!target) return;
        e.preventDefault();
        const targetTop = Math.floor(target.getBoundingClientRect().top + window.pageYOffset - getHeaderOffset());
        pinActive(id, targetTop);
        window.scrollTo({ top: targetTop, behavior:'smooth' });
      });
    });
    setBodyPadding(); measure(); onScroll();
  });
});
</script>
<!-- ========= /HOTEL HEADER + NAV ========= -->
