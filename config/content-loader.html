<script>
async function loadEventContent() {
  try {
    // --- Parse URL ---
    const parts = window.location.pathname.split("/").filter(Boolean);
    if (parts.length < 2) return;
    const showKey = parts[0].toLowerCase();

    console.log("URL parts:", parts);

    // --- Fetch content-directory.json ---
    const dirUrl = "https://elessarrrgh.github.io/transportation-hub/config/content-directory.json";
    const directory = await fetch(dirUrl + "?nocache=" + Date.now()).then(r => r.json());
    const showJsonUrl = directory[showKey];
    if (!showJsonUrl) return;

    // --- Fetch show JSON ---
    const showData = await fetch(showJsonUrl + "?nocache=" + Date.now()).then(r => r.json());

    // -------------------------------
    // Hotel Pages
    // -------------------------------
    if (window.location.pathname.includes("/hotels")) {
      const route = parts[3]; // corrected index
      const stop = parts[4];  // corrected index

      if (showData.routes && route && showData.routes[route]) {
        const routeData = showData.routes[route];

        // Wait-time iframe
        if (routeData["wait-time"]) {
          const waitIframe = document.querySelector("#wait-time-accordion iframe.wait-time");
          if (waitIframe) waitIframe.src = routeData["wait-time"];
        }

        // Shuttle flyer
        if (routeData.flyer) {
          const flyerPreview = document.querySelector("#flyer-accordion .flyer-preview img");
          const flyerLink = document.querySelector("#flyer-accordion .view-flyer-button");
          if (flyerPreview) flyerPreview.src = routeData.flyer.preview;
          if (flyerLink) flyerLink.href = routeData.flyer.pdf;
        }

        // Shuttle signage
        if (routeData.sign) {
          const signPreview = document.querySelector("#sign-accordion .sign-preview img");
          const signLink = document.querySelector("#sign-accordion .view-sign-button");
          if (signPreview) signPreview.src = routeData.sign.preview;
          if (signLink) signLink.href = routeData.sign.pdf;
        }

        // Panorama (stop-specific) â€” OPTION 1: lazy-load
        if (routeData.stops && stop && routeData.stops[stop]) {
          const stopData = routeData.stops[stop];
          const panoDiv = document.querySelector("#panorama-accordion .accordion-body");

          if (panoDiv && stopData.panorama) {
            // Update the data-iframe-src so accordion creates the iframe on click
            panoDiv.setAttribute("data-iframe-src", stopData.panorama);
            console.log(`Panorama data-iframe-src set for route ${route}, stop ${stop}: ${stopData.panorama}`);
          }
        }
      }
    }

    // -------------------------------
    // Additional pages (landing, map, flight-info) would go here...
    // -------------------------------

  } catch (err) {
    console.error("Error loading event content:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadEventContent);
</script>