<script>
async function loadEventContent() {
  try {
    // --- Parse URL ---
    const parts = window.location.pathname.split("/").filter(Boolean);
    if (parts.length < 2) return;
    const showKey = parts[0].toLowerCase();

    console.log("URL parts:", parts);

    // --- Fetch content-directory.json ---
    const dirUrl = "https://elessarrrgh.github.io/transportation-hub/config/content-directory.json";
    const directory = await fetch(dirUrl + "?nocache=" + Date.now()).then(r => r.json());
    const showJsonUrl = directory[showKey];
    if (!showJsonUrl) return;

    // --- Fetch show JSON ---
    const showData = await fetch(showJsonUrl + "?nocache=" + Date.now()).then(r => r.json());

    // -------------------------------
    // Hotel Pages
    // -------------------------------
    if (window.location.pathname.includes("/hotels")) {
      const route = parts[3]; // corrected index
      const stop = parts[4];  // corrected index

      if (showData.routes && route && showData.routes[route]) {
        const routeData = showData.routes[route];

        // Wait-time iframe
        if (routeData["wait-time"]) {
          const waitIframe = document.querySelector("#wait-time-accordion iframe.wait-time");
          if (waitIframe) waitIframe.src = routeData["wait-time"];
        }

        // Shuttle flyer
        if (routeData.flyer) {
          const flyerPreview = document.querySelector("#flyer-accordion .flyer-preview img");
          const flyerLink = document.querySelector("#flyer-accordion .view-flyer-button");
          if (flyerPreview) flyerPreview.src = routeData.flyer.preview;
          if (flyerLink) flyerLink.href = routeData.flyer.pdf;
        }

        // Shuttle signage
        if (routeData.sign) {
          const signPreview = document.querySelector("#sign-accordion .sign-preview img");
          const signLink = document.querySelector("#sign-accordion .view-sign-button");
          if (signPreview) signPreview.src = routeData.sign.preview;
          if (signLink) signLink.href = routeData.sign.pdf;
        }

        // Panorama (stop-specific) â€” OPTION 1: lazy-load
        if (routeData.stops && stop && routeData.stops[stop]) {
          const stopData = routeData.stops[stop];
          const panoDiv = document.querySelector("#panorama-accordion .accordion-body");

          if (panoDiv && stopData.panorama) {
            // Update the data-iframe-src so accordion creates the iframe on click
            panoDiv.setAttribute("data-iframe-src", stopData.panorama);
            console.log(`Panorama data-iframe-src set for route ${route}, stop ${stop}: ${stopData.panorama}`);
          }
        }
      }
    }

    // -------------------------------
    // Landing Page
    // -------------------------------
    if (window.location.pathname.includes("/transport-hub")) {
      const titleEl = document.querySelector("[data-event-base='title']");
      if (titleEl && showData.base?.title) {
        titleEl.innerText = showData.base.title;
        console.log("Landing page title loaded:", showData.base.title);
      }

      const mapEl = document.querySelector("[data-event-base='event-map']");
      if (mapEl && showData.base?.["event-map"]) {
        mapEl.innerHTML = showData.base["event-map"];
        console.log("Landing page event-map loaded");
      }
    }

    // -------------------------------
    // Interactive Map Page
    // -------------------------------
    if (window.location.pathname.includes("/interactive-map")) {
      const mapIframe = document.querySelector("iframe.rounded-iframe");
      if (mapIframe && showData["interactive-map"]) {
        mapIframe.src = showData["interactive-map"];
        console.log("Interactive map src updated from JSON");
      }
    }

    // -------------------------------
    // Flight Info Page
    // -------------------------------
    if (window.location.pathname.includes("/flight-info")) {
      const flightInfo = showData["flight-info"];
      if (!flightInfo) return;

      const arrivalsIframe = document.querySelector("#arrivals-accordion iframe");
      if (arrivalsIframe && flightInfo["arrivals-widget"]) {
        arrivalsIframe.src = flightInfo["arrivals-widget"];
        console.log("Arrivals iframe loaded:", arrivalsIframe.src);
      }

      const departuresIframe = document.querySelector("#departures-accordion iframe");
      if (departuresIframe && flightInfo["departures-widget"]) {
        departuresIframe.src = flightInfo["departures-widget"];
        console.log("Departures iframe loaded:", departuresIframe.src);
      }

      const travelIframe = document.querySelector("iframe.airport-travel-preview");
      if (travelIframe && flightInfo["travel-time"]) {
        travelIframe.src = flightInfo["travel-time"];
        console.log("Travel time iframe loaded:", travelIframe.src);
      }
    }
  } catch (err) {
    console.error("Error loading event content:", err);
  }
}

document.addEventListener("DOMContentLoaded", loadEventContent);
</script>